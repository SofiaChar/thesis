- step:
    name: load
    image: python:3.9
    environment: sama-aws-eu-west-1-p2-xlarge
    command:
      - pip install SimpleITK pyradiomics PyWavelets pykwalify numpy==1.26.4
      - pip install pydicom
      - pip install matplotlib ipywidgets
      - pip install valohai-utils
      - pip install tqdm
      - pip install scikit-image
      - python hcc_load_and_extract.py
    inputs:
      - name: hcc_dataset
        default: https://dd-sample-bucket.s3.eu-west-1.amazonaws.com/sofiia-thesis/hcc_full.zip
        optional: True
    parameters:
      - name: visualize
        default: False
        type: flag
      - name: test_less_hu
        default: False
        type: flag

- step:
    name: prepare_dataset
    image: python:3.9
    environment: azure-westeurope-f2sv2
    command:
      - pip install SimpleITK pyradiomics PyWavelets pykwalify numpy==1.26.4
      - pip install pandas scikit-learn openpyxl
      - pip install matplotlib
      - pip install tqdm
      - pip install pydicom ipywidgets
      - pip install valohai-utils

      - python prepare_dataset.py
    inputs:
      - name: dataset
        default: datum://hcc_radiomics_extracted
      - name: labels
        default: datum://hcc_labels

- step:
    name: train
    image: python:3.9
    environment: azure-westeurope-f2sv2
    command:
      - pip install numpy pandas scikit-learn matplotlib
      - python train.py {parameters}
    inputs:
      - name: dataset
        default: datum://{parameter:transformation_type}
    parameters:
      - name: transformation_type
        default: original
        type: string
      - name: n_estimators
        default: 100
        type: integer
        description: Number of trees in the forest
      - name: max_depth
        default: 0
        type: integer
        description: Maximum depth of the tree
      - name: min_samples_split
        default: 2
        type: integer
        description: Minimum number of samples required to split an internal node
      - name: min_samples_leaf
        default: 1
        type: integer
        description: Minimum number of samples required to be at a leaf node
